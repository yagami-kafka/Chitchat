<!doctype html>
{% load static %}

<html lang="en">

    
<head>
        
        <meta charset="utf-8" />
        <META http-equiv="Content-Type" content="text/html; charset= ISO-8859-1">
        <title>Chat | ChitChat -Chat App</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Responsive Bootstrap 4 Chat App" name="description" />
        <meta content="Themesbrand" name="author" />
        <!-- App favicon -->
        <link rel="shortcut icon" href="assets/images/favicon.ico">

        <!-- magnific-popup css -->

        <link rel="stylesheet" href="{% static 'css/searchuser.css' %}">

        <link href="{% static 'assets/libs/magnific-popup/magnific-popup.css' %}" rel="stylesheet" type="text/css" />
        <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>

        <!-- owl.carousel css -->
        <link rel="stylesheet" href="{% static 'assets/libs/owl.carousel/assets/owl.carousel.min.css' %} ">

        <link rel="stylesheet" href="{% static 'assets/libs/owl.carousel/assets/owl.theme.default.min.css' %}">

        <!-- Bootstrap Css -->
        <link href="{% static 'assets/css/bootstrap.min.css' %}" id="bootstrap-style" rel="stylesheet" type="text/css" />

        <!-- Icons Css -->
        <link href="{% static 'assets/css/icons.min.css' %}" rel="stylesheet" type="text/css" />
        <!-- App Css-->
        <link href="{% static 'assets/css/app.min.css' %}" id="app-style" rel="stylesheet" type="text/css" />
        <link rel="stylesheet" href="{% static 'package/css/lightgallery-bundle.css' %}" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/11.0.1/markdown-it.min.js" integrity="sha512-hW0KbtvDnXCHbh2UCNP/6R+oXxCKiOfm9ciuUekdGBCQF1+57bGqZAk3sAFir7PMQstyRW0UecsSc2HQotH2vg==" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/default.min.css" integrity="sha512-kZqGbhf9JTB4bVJ0G8HCkqmaPcRgo88F0dneK30yku5Y/dep7CZfCnNml2Je/sY4lBoqoksXz4PtVXS4GHSUzQ==" crossorigin="anonymous" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js" integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/kotlin.min.js" integrity="sha512-8aYTnyDstX39PHxorDD+6ROknf98Vqr5KTOjwRCl/442uAVKOpCJ5wY9I3VQ6y46rdDJKYBIglIfE2+GQk8U5Q==" crossorigin="anonymous"></script>
        <script>hljs.initHighlightingOnLoad();</script>

    </head>

    <body>
        {{ private_thread_json |json_script:"private_thread" }}
        {{ current_user |json_script:"logged_in_user"}}
        {{ keys |json_script:"keys"}}
        {{ my_user |json_script:"my_user_json" }}
        {{ null | json_script:"thread_distinguish"}}
        <div class="modal left fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
    
                    <div class="modal-header">
                        <button type="button" class="btn nav-btn" data-bs-dismiss="modal" aria-label="Close"><i class="ri-close-line"></i></button>
                        <h4 class="modal-title" id="myModalLabel">Left Sidebar</h4>
                    </div>
    
                    <div class="modal-body">
                        <div class="modal-list">
                            <a href="{% url 'accounts:profile' userId=request.user.id %}"><li>My profile</li></a>
                            <li>Friends</li>
                            <a href="{% url 'logout' %}" onclick="clearStorage()"><li>Logout</li></a>
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#group_creation_modal" onclick="clearStorage()">
                                Create Group
                            </button>
                        </div>
                    </div>
    
                </div><!-- modal-content -->
            </div><!-- modal-dialog -->
        </div><!-- modal -->


          <!-- Client Error MODAL -->
            <button type="button" id="id_trigger_client_error_modal" class="d-none btn btn-primary" data-bs-toggle="modal" data-bs-target="#id_client_error_modal">
            </button>
            <div class="modal fade" id="id_client_error_modal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Error</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p id="id_client_error_modal_body">Something went wrong.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="id_client_error_modal_close_btn">Close</button>
                </div>
                </div>
            </div>
            </div>
        <!-- Client Error MODAL -->


        <!--Group chat name change modal -->
        <div class="modal fade" id="gc_name_change_modal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Change Chat Name</h5>
                    <button type="button" class="close btn nav-btn" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id = 'chat_name_change_form'>
                        <div class="row form-group">
                        <div class="col-md-12">
                            <input type="text" name="change_group_name" autocomplete="off" id="change_group_name" class="form-control" placeholder="Group chat name" required>
                        </div>
                    </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="chat_change_name_close_btn">Close</button>
                    <input type="button" class="btn btn-primary" form="chat_name_change_form" id="chat_name_change_submit" value="Create" disabled="">
                </div>
                </div>
            </div>
            </div>
        <!--ENd group chat name change modal-->

        <div class="modal fade" id="gc_photo_change_modal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Change Chat Photo</h5>
                    <button type="button" class="close btn nav-btn" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="gc_photo_change_form" method="POST" enctype="multipart/form-data">
                        <h5 class="font-size-14 mb-1">Change Group Photo</h5>

                        <div class="row form-group">
                        <div class="col-md-12">
                            <input type="file" name="change_gc_photo" autocomplete="off" id="change_gc_photo" class="form-control" placeholder="Group chat name">
                        </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="chat_change_photo_close_btn">Close</button>
                    <input type="button" class="btn btn-primary" form="gc_photo_change_form" id="chat_photo_change_submit" value="Save">
                </div>
                </div>
            </div>
            </div>
        


         <!-- Modal  for group chat creation-->
        <div class="modal fade" id="group_creation_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Create Group chat</h5>
                <button type="button" class="close btn nav-btn" data-bs-dismiss="modal" aria-label="Close">
                    <span style="font-size: 20px;" aria-hidden="true">&times;</span>
                </button>
                </div>
                <div class="modal-body">
                <form id = 'group_creation_form'  enctype="multipart/form-data" onkeydown="return event.key != 'Enter';">
                    {% csrf_token %}
                    <div class="row form-group">
                    <div class="col-md-12">
                        <input type="text" name="group_name" autocomplete="off" id="group_name" class="form-control" placeholder="Group chat name" required>
                    </div>
                </div>
                <div class="row form-group">
                    <div class="col-md-12 text-secondary form-group">
                    <label for="group_image">Group Image</label>
                    <input type="file" name="group_image" class="form-control" id="group_image">
                    </div>
                </div>
                <div class="row form-group">
                    <div class="col-md-12 text-secondary">
                    <input type="text" name="group_description" id="group_description" class="form-control" placeholder="Write something about group">
                    <img id="blah" src="#" alt="your image" />
                    </div>
                </div>
                <div class="form-group add-member" id="add-member">
                    <h5>Add Members</h5>
                        <div class='contacts_preview d-flex' id='contacts_preview'>
                        
                        </div>
                        <input type="text" name="add_member_search" autocomplete="off" placeholder="Search people to add..." id="new_member_add" class="form-control">
                        <div class="members-result-box" id="members-result-box">
                        </div>

                </div>
                </form>
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="clearStorage();" data-bs-dismiss="modal">Close</button>
                <input type="submit" class="btn btn-primary" form="group_creation_form" id="submit_gc_creation" value="Create">
                </div>
            </div>
            </div>
        </div>

        <!-- Modal  for adding members -->
        <div class="modal fade" id="add_member_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Add members to chat</h5>
            <button type="button" class="close btn nav-btn" data-bs-dismiss="modal" aria-label="Close">
                <span style="font-size: 20px;" aria-hidden="true">&times;</span>
            </button>
            </div>
            <div class="modal-body">
            <form id = 'member_add_form' onkeydown="return event.key != 'Enter';">
            <div class="form-group add-member" id="add-member">
                    <div class='contacts_preview d-flex' id='update_contacts_preview'>
                    
                    </div>
                    <input type="text" name="add_member_search" onclick="clearStorage();" autocomplete="off" placeholder="Search people to add..." id="add_member_search" class="form-control">
                    <div class="members-result-box" id="update-members-result-box">
                    </div>

            </div>
            </form>
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <input type="submit" class="btn btn-primary" form="member_add_form" id="submit_member_add" value="Add">
            </div>
        </div>
        </div>
        </div>

        <div style="background-color: var(--themecolor);" class="layout-wrapper d-lg-flex">

            <!-- Start left sidebar-menu -->

            <!-- end left sidebar-menu -->

            <!-- start chat-leftsidebar -->
            <div class="chat-leftsidebar">

                <div class="tab-content">
                    <!-- Start Profile tab-pane -->
                    <!-- End Profile tab-pane -->

                    <!-- Start chats tab-pane -->
                    <div class="tab-pane fade show active" id="pills-chat" role="tabpanel" aria-labelledby="pills-chat-tab">
                        <!-- Start chats content -->
                        <div>
                            <div class="px-4 pt-4">
                                
                                <h4 class="mb-4 logo_name">Chats</h4>
                                <span><i class="bx bx-menu" id="menubtn" data-bs-toggle="modal" data-bs-target="#myModal"></i></span>

                                <div class="search-box chat-search-box">            
                                    <div class="input-group mb-3 rounded-3">
                                        <span class="input-group-text text-muted bg-white pe-1 ps-3" id="basic-addon1">
                                            <i class="ri-search-line search-icon font-size-18"></i>
                                        </span>
                                        <form id="searchbar" class="form-control bg-white"autocomplete="off" onkeydown="return event.key != 'Enter';">
                                            {% csrf_token %}
                                        <input type="text" class="form-control bg-white" id="search-input"  placeholder="Search users" aria-label="Search messages or users" aria-describedby="basic-addon1">
                                    </form>
                                    <div id="results-box" class="results-card not-visible">

                                    </div>
                                    </div> 
                                </div> <!-- Search Box-->
                            </div> <!-- .p-4 -->
    
                            <!-- Start user status -->
                            {% if chat_threads %}
                            <div class="px-4 pb-4 d-none" dir="ltr" >

                                <div class="owl-carousel owl-theme" id="user-status-carousel">
                                    {% for thread in chat_threads %}
                                    {% if thread.first_user or thread.second_user %}
                                    {% if thread.first_user == request.user %}
                                    <div class="item">
                                        <a href="#" class="user-status-box">
                                            <div class="avatar-xs mx-auto d-block chat-user-img online">
                                                <img src="{{thread.second_user.profile_image.url}}" alt="user-img" class="avatar-xs rounded-circle">
                                                <span class="user-status"></span>
                                            </div>
    
                                            <h5 class="font-size-13 text-truncate mt-3 mb-1">{{thread.second_user.username}}</h5>
                                        </a>
                                    </div>
                                    {% else %}
                                    <div class="item">
                                        <a href="#" class="user-status-box">
                                            <div class="avatar-xs mx-auto d-block chat-user-img online">
                                                <img src="{{ thread.first_user.profile_image.url }}" alt="user-img" class="avatar-xs rounded-circle">
                                                <span class="user-status"></span>
                                            </div>
    
                                            <h5 class="font-size-13 text-truncate mt-3 mb-1">{{thread.first_user.username}}</h5>
                                        </a>
                                    </div>
                                    {% endif %}
                                    {% endif %}
                                    {% endfor %}
                                    
                                </div>
                                <!-- end user status carousel -->
                            </div>
                            {% endif %}
                            <!-- end user status -->

                            <!-- Start chat-message-list -->
                            <div id="contact-list" class="px-2">
                                <h5 class="mb-3 px-3 text-white font-size-20">Recent</h5>

                                <div class="chat-message-list" data-simplebar>
            
                                    <ul class="list-unstyled chat-list chat-user-list" id="contact_list_ul">
                                        {% if chat_threads %}
                                        {% for thread in chat_threads %}
                                        {% if thread.first_user or thread.second_user  %}

                                            {% if thread.first_user == request.user %}
                                            <li class="myclass">
                                                <a onclick="onSelectFriend('{{thread.second_user.id}}',this);" data-threadType="private-thread" data-userId="{{thread.second_user.id}}" id="id_friend_list_{{thread.second_user.id}}">
                                                    <div class="d-flex">                            
                                                        <div class="chat-user-img online align-self-center me-3 ms-0">
                                                            <img id="id_friend_img_{{thread.second_user.id}}" src="{{thread.second_user.profile_image.url}}" class="rounded-circle avatar-sm" alt="">
                                                            <!-- <span class="user-status"></span> -->
                                                        </div>
                                
                                                        <div class="flex-1 overflow-hidden">
                                                            <h5 class="text-truncate text-white font-size-15 mb-1">{{thread.second_user.first_name}} {{thread.second_user.last_name}}</h5>
                                                            <p class="chat-user-message pvt-chat-message-list text-white text-truncate mb-0" msgid="{{thread.last_msg.id}}">{{thread.last_msg.message_content}}</p>
                                                        </div>
                                                        <div class="font-size-11">05 min</div>
                                                    </div>
                                                </a>
                                            </li>
                                            {% else %}
                                            <li class="myclass">
                                                <a onclick="onSelectFriend('{{thread.first_user.id}}',this);" data-threadType="private-thread" data-userId="{{thread.first_user.id}}" id="id_friend_list_{{thread.first_user.id}}">
                                                    <div class="d-flex">                            
                                                        <div class="chat-user-img online align-self-center me-3 ms-0">
                                                            <img id="id_friend_img_{{thread.first_user.id}}" src="{{thread.first_user.profile_image.url}}" class="rounded-circle avatar-sm" alt="">
                                                            <!-- <span class="user-status"></span> -->
                                                        </div>
                                
                                                        <div class="flex-1 overflow-hidden">
                                                            <h5 class="text-truncate text-white font-size-15 mb-1">{{thread.first_user.first_name}} {{thread.first_user.last_name}}</h5>
                                                            <p class="chat-user-message pvt-chat-message-list text-white text-truncate mb-0" msgid="{{thread.last_msg.id}}">{{thread.last_msg.message_content}}</p>
                                                        </div>
                                                        <div class="font-size-11">05 min</div>
                                                    </div>
                                                </a>
                                            </li>
                                            {% endif %}
                                        {% else %}
                                        <li class="myclass">
                                            <a onclick="onSelectGroup('{{thread.id}}',this);" data-threadType="group-thread" class="myclass" data-userId="{{thread.id}}" id="id_friend_list_{{thread.id}}">
                                                <div class="d-flex">                            
                                                    <div class="chat-user-img online align-self-center me-3 ms-0">
                                                        <img id="id_friend_img_{{thread.id}}" src="{{thread.image.url}}" class="rounded-circle avatar-sm" alt="">
                                                        <!-- <span class="user-status"></span> -->
                                                    </div>
                            
                                                    <div class="flex-1 overflow-hidden">
                                                        <h5 class="text-truncate text-white font-size-15 mb-1">{{thread.group_name}}</h5>
                                                        <p class="chat-user-message text-white text-truncate mb-0">{{thread.latest_msg}}</p>
                                                    </div>
                                                    <div class="font-size-11">05 min</div>
                                                </div>
                                            </a>
                                        </li>
                                        {% endif %}
                                        {% endfor %}
                                        {% endif %}
                                    </ul>
                                </div>
                            </div>
                            <!-- End chat-message-list -->
                        </div>
                        <!-- Start chats content -->
                    </div>
                </div>
                <!-- end tab content -->

            </div>
            <!-- end chat-leftsidebar -->

            <!-- Start User chat -->
            <div class="user-chat w-100 overflow-hidden">
                <div class="d-lg-flex">

                    <!-- start chat conversation section -->
                    <div class="w-100 overflow-hidden position-relative">
                        <div style="background-color:var(--themecolor);" class="p-3 p-lg-2 border-bottom user-chat-topbar">
                            <div class="row align-items-center">
                                <div class="col-sm-4 col-8">
                                    <div class="d-flex align-items-center">
                                        <div class="d-block d-lg-none me-2 ms-0">
                                            <a href="javascript: void(0);" class="user-chat-remove text-muted font-size-16 p-2"><i class="ri-arrow-left-s-line"></i></a>
                                        </div>
                                        <div class="me-3 ms-0">
                                            <img src="{% static 'images/nouser.jpg' %}" id="topbar_otheruser_image" class="rounded-circle avatar-xs" alt="">
                                        </div>
                                        <div class="flex-grow-1 overflow-hidden">
                                            <h5 class="font-size-16 mb-0 text-truncate"><a href="#" id="topbar_otheruser_name" class="text-white user-profile-show"></a><i class="ri-record-circle-fill font-size-10 text-success d-inline-block ms-1"></i></h5>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-8 col-4">
                                    <ul class="list-inline user-chat-nav text-end mb-0">                                        
    
                                        <li class="list-inline-item d-lg-inline-block me-2 ms-0">
                                            <button type="button" id="user-profile-show-btn" class="btn nav-btn user-profile-show">
                                                <i class="ri-more-fill text-white"></i>
                                            </button>
                                        </li>
                                    </ul>                                    
                                </div>
                            </div>
                        </div>
                        <!-- end chat user head -->
    
                        <!-- start chat conversation -->
                        <div id="chat_section" style="overscroll-behavior: none;" class="chat-conversation d-flex flex-column">
                            <div class="loader">
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                            <div id="id_chat_log" class="d-flex chat-log">
                                 
                                <h3 style="margin-bottom: 300px;margin-left:150px;">Select the chat to start conversation</h5>

                            </div> 
                        </div>
                        <!-- end chat conversation end -->
    
                        <!-- start chat input section -->
                        <div class="chat-input-section p-3 p-lg-2 border-top mb-0">
                            <span class="" id="page_number_id" style="display: none;">1</span>
                            <div class="row g-0">
                                
                                <div class="col">
                                    <textarea style="resize: none;height: 35px;" class="form-control form-control-lg bg-light border-light" id="chat_message_input" placeholder="Enter Message..."></textarea>
                                </div>
                                <div class="col-auto">
                                    <div class="chat-input-links ms-md-2 me-md-0">
                                        <ul class="list-inline mb-0">
                                            <li class="list-inline-item" data-bs-toggle="tooltip" data-bs-placement="top" title="Emoji">
                                                <button type="button" class="btn btn-link text-decoration-none font-size-16 btn-lg waves-effect">
                                                    <i class="ri-emotion-happy-line"></i>
                                                </button>
                                            </li>
                                            <li class="list-inline-item" data-bs-toggle="tooltip" data-bs-placement="top" title="Attached File">  
                                                <button type="button" id="test_thread" class="btn btn-link text-decoration-none font-size-16 btn-lg waves-effect">
                                                    <i class="ri-attachment-line"></i>
                                                </button>
                                            </li>
                                            <li class="list-inline-item">
                                                <button id="chat_message_send_btn" type="submit" class="btn btn-primary font-size-16 btn-lg chat-send waves-effect waves-light">
                                                    <i class="ri-send-plane-2-fill"></i>
                                                </button>
                                            </li>
                                        </ul>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                        <!-- end chat input section -->
                    </div>
                    <!-- end chat conversation section -->
    
                    <!-- start User profile detail sidebar -->
                    <div class="user-profile-sidebar">
                        <div class="">
                            <div class="user-chat-nav text-end">
                                <button type="button" class="btn nav-btn" id="user-profile-hide">
                                    <i class="ri-close-line"></i>
                                </button>
                            </div>
                        </div>

                        <div class="text-center p-0">
                        <a style="text-decoration: none;cursor: pointer;color: white;" id="other_user_info">
                            <div class="mb-4">
                                <img src="{% static 'images/nouser.jpg' %}" id="other_user_profile_image" class="rounded-circle avatar-lg img-thumbnail" alt="">
                            </div>

                            <h5 id="id_other_username" class="font-size-16 mb-1 text-white text-truncate"></h5>
                            </a>
                            <p style="color: white;" class=" text-truncate mb-1"><i class="ri-record-circle-fill font-size-10 text-success me-1 ms-0"></i> Active</p>
                        </div>
                        <!-- End profile user -->

                        <!-- Start user-profile-desc -->
                        <div class="p-4 user-profile-desc" data-simplebar>
                            <div class="accordion" id="myprofile">
            
                                <div class="accordion-item card border mb-2">
                                    <div class="accordion-header" id="about3">
                                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#aboutprofile" aria-expanded="true" aria-controls="aboutprofile">
                                            <h5 class="font-size-14 m-0" id="sidebar_simplebar_about">
                                                <i class="ri-user-2-line me-2 ms-0 align-middle d-inline-block"></i>
                                            </h5>
                                        </button>
                                    </div>
                                    <div id="aboutprofile" class="accordion-collapse collapse show" aria-labelledby="about3" data-bs-parent="#myprofile">
                                        <div class="accordion-body">
                                            <div>
                                                <p class="text-muted mb-1">Name</p>
                                                <h5 class="font-size-14" id="sidebar_user_name"></h5>
                                            </div>
                                            <div class="mt-4">
                                                <p class="text-muted mb-1">Username</p>
                                                <h5 class="font-size-14 mb-0" id="sidebar_user_username"></h5>
                                            </div>
                                            <div class="mt-4">
                                                <p class="text-muted mb-1">Email</p>
                                                <h5 class="font-size-14" id="sidebar_user_email"></h5>
                                            </div>                                            
                                        </div>
                                    </div>
                                </div>

                                <div id="group_members_wrapper" class="accordion-item card border mb-2 d-none">
                                    <div class="accordion-header" id="about3">
                                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#group_members" aria-expanded="true" aria-controls="aboutprofile">
                                            <h5 class="font-size-14 m-0" id="sidebar_simplebar_grp_members">
                                                <i class="ri-user-2-line me-2 ms-0 align-middle d-inline-block"></i>
                                            </h5>
                                        </button>
                                    </div>
                                    <div id="group_members" class="accordion-collapse collapse show" aria-labelledby="about3" data-bs-parent="#myprofile">
                                        
                                    </div>
                                    <div class="card p-2 border mb-2">
                                        <div class="d-flex align-items-center" style="cursor: pointer;">
                                            <div class="flex-1">
                                                <div class="text-start">
                                                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#add_member_modal" style="width: 100%;">Add Member</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item card border">
                                    <div class="accordion-header" id="attachfile3">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#attachprofile" aria-expanded="false" aria-controls="attachprofile">
                                            <h5 class="font-size-14 m-0">
                                                <i class="ri-attachment-line me-2 ms-0 align-middle d-inline-block"></i> Attached Files
                                            </h5>
                                        </button>
                                    </div>
                                    <div id="attachprofile" class="accordion-collapse collapse" aria-labelledby="attachfile3" data-bs-parent="#myprofile">
                                        <div class="accordion-body">
                                            <div class="card p-2 border mb-2">
                                                <div class="d-flex align-items-center">
                                                    <div class="avatar-sm me-3 ms-0">
                                                        <div class="avatar-title bg-soft-primary text-primary rounded font-size-20">
                                                            <i class="ri-file-text-fill"></i>
                                                        </div>
                                                    </div>
                                                    <div class="flex-1">
                                                        <div class="text-start">
                                                            <h5 class="font-size-14 mb-1">admin_v1.0.zip</h5>
                                                            <p class="text-muted font-size-13 mb-0">12.5 MB</p>
                                                        </div>
                                                    </div>

                                                    <div class="ms-4 me-0">
                                                        <ul class="list-inline mb-0 font-size-18">
                                                            <li class="list-inline-item">
                                                                <a href="#" class="text-muted px-1">
                                                                    <i class="ri-download-2-line"></i>
                                                                </a>
                                                            </li>
                                                            <li class="list-inline-item dropdown">
                                                                <a class="dropdown-toggle text-muted px-1" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                    <i class="ri-more-fill"></i>
                                                                </a>
                                                                <div class="dropdown-menu dropdown-menu-end">
                                                                    <a class="dropdown-item" href="#">Action</a>
                                                                    <a class="dropdown-item" href="#">Another action</a>
                                                                    <div class="dropdown-divider"></div>
                                                                    <a class="dropdown-item" href="#">Delete</a>
                                                                </div>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="card p-2 border mb-2">
                                                <div class="d-flex align-items-center">
                                                    <div class="avatar-sm me-3 ms-0">
                                                        <div class="avatar-title bg-soft-primary text-primary rounded font-size-20">
                                                            <i class="ri-image-fill"></i>
                                                        </div>
                                                    </div>
                                                    <div class="flex-1">
                                                        <div class="text-start">
                                                            <h5 class="font-size-14 mb-1">Image-1.jpg</h5>
                                                            <p class="text-muted font-size-13 mb-0">4.2 MB</p>
                                                        </div>
                                                    </div>

                                                    <div class="ms-4 me-0">
                                                        <ul class="list-inline mb-0 font-size-18">
                                                            <li class="list-inline-item">
                                                                <a href="#" class="text-muted px-1">
                                                                    <i class="ri-download-2-line"></i>
                                                                </a>
                                                            </li>
                                                            <li class="list-inline-item dropdown">
                                                                <a class="dropdown-toggle text-muted px-1" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                    <i class="ri-more-fill"></i>
                                                                </a>
                                                                <div class="dropdown-menu dropdown-menu-end">
                                                                    <a class="dropdown-item" href="#">Action</a>
                                                                    <a class="dropdown-item" href="#">Another action</a>
                                                                    <div class="dropdown-divider"></div>
                                                                    <a class="dropdown-item" href="#">Delete</a>
                                                                </div>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="card p-2 border mb-2">
                                                <div class="d-flex align-items-center">
                                                    <div class="avatar-sm me-3 ms-0">
                                                        <div class="avatar-title bg-soft-primary text-primary rounded font-size-20">
                                                            <i class="ri-image-fill"></i>
                                                        </div>
                                                    </div>
                                                    <div class="flex-1">
                                                        <div class="text-start">
                                                            <h5 class="font-size-14 mb-1">Image-2.jpg</h5>
                                                            <p class="text-muted font-size-13 mb-0">3.1 MB</p>
                                                        </div>
                                                    </div>

                                                    <div class="ms-4 me-0">
                                                        <ul class="list-inline mb-0 font-size-18">
                                                            <li class="list-inline-item">
                                                                <a href="#" class="text-muted px-1">
                                                                    <i class="ri-download-2-line"></i>
                                                                </a>
                                                            </li>
                                                            <li class="list-inline-item dropdown">
                                                                <a class="dropdown-toggle text-muted px-1" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                    <i class="ri-more-fill"></i>
                                                                </a>
                                                                <div class="dropdown-menu dropdown-menu-end">
                                                                    <a class="dropdown-item" href="#">Action</a>
                                                                    <a class="dropdown-item" href="#">Another action</a>
                                                                    <div class="dropdown-divider"></div>
                                                                    <a class="dropdown-item" href="#">Delete</a>
                                                                </div>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="card p-2 border mb-2">
                                                <div class="d-flex align-items-center">
                                                    <div class="avatar-sm me-3 ms-0">
                                                        <div class="avatar-title bg-soft-primary text-primary rounded font-size-20">
                                                            <i class="ri-file-text-fill"></i>
                                                        </div>
                                                    </div>
                                                    <div class="flex-1">
                                                        <div class="text-start">
                                                            <h5 class="font-size-14 mb-1">Landing-A.zip</h5>
                                                            <p class="text-muted font-size-13 mb-0">6.7 MB</p>
                                                        </div>
                                                    </div>

                                                    <div class="ms-4 me-0">
                                                        <ul class="list-inline mb-0 font-size-18">
                                                            <li class="list-inline-item">
                                                                <a href="#" class="text-muted px-1">
                                                                    <i class="ri-download-2-line"></i>
                                                                </a>
                                                            </li>
                                                            <li class="list-inline-item dropdown">
                                                                <a class="dropdown-toggle text-muted px-1" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                    <i class="ri-more-fill"></i>
                                                                </a>
                                                                <div class="dropdown-menu dropdown-menu-end">
                                                                    <a class="dropdown-item" href="#">Action</a>
                                                                    <a class="dropdown-item" href="#">Another action</a>
                                                                    <div class="dropdown-divider"></div>
                                                                    <a class="dropdown-item" href="#">Delete</a>
                                                                </div>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item card border">
                                    <div class="accordion-header" id="attachfile3">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#attachmedia" aria-expanded="false" aria-controls="attachprofile">
                                            <h5 class="font-size-14 m-0">
                                                <i class="ri-attachment-line me-2 ms-0 align-middle d-inline-block"></i> Attached Files
                                            </h5>
                                        </button>
                                    </div>
                                    <div id="attachmedia" class="accordion-collapse collapse" aria-labelledby="attachfile3" data-bs-parent="#myprofile">
                                        <div id="lightgallery" class="myGallery">

                                            <img src="{% static 'images/banner.jpg' %}" alt="" srcset="">
                                            <img src="https://picsum.photos/190/190?1" class="shared_media_size img-thumbnail" alt="" />
                                            <img src="https://picsum.photos/190/190?2" class="shared_media_size img-thumbnail" alt=""  />
                                            <img src="https://picsum.photos/190/190?3" class="shared_media_size img-thumbnail" alt="" />
                                            <img src="https://picsum.photos/190/190?4" class="shared_media_size img-thumbnail" alt="" />
                                            <img src="https://picsum.photos/190/190?5" class="shared_media_size img-thumbnail" alt="" />
                                            <img src="https://picsum.photos/190/190?6" class="shared_media_size img-thumbnail" alt="" />
                                            <img src="https://picsum.photos/190/190?7" class="shared_media_size img-thumbnail" alt="" />
                                            <img src="https://picsum.photos/190/190?8" class="shared_media_size img-thumbnail" alt="" />
                                            <img src="https://picsum.photos/190/190?9" class="shared_media_size img-thumbnail" alt="" />
                                            <img src="https://picsum.photos/190/190?10"class="shared_media_size img-thumbnail" alt=""  />
                                        </div>
                                    </div>
                                </div>
                            <!-- end profile-user-accordion -->
                        </div>
                        <!-- end user-profile-desc -->
                    </div>
                    <!-- end User profile detail sidebar -->
                </div>
            </div>
        </div>
        <!-- end  layout wrapper -->

        <!-- JAVASCRIPT LIBRARY -->


        <script src="{% static 'assets/libs/jquery/jquery.min.js' %}"></script>
        <script src="{% static 'assets/libs/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
        <script src="{% static 'assets/libs/simplebar/simplebar.min.js' %}"></script>
        <script src="{% static 'assets/libs/node-waves/waves.min.js' %}"></script>
        <!--Custom JAVASCRIPT -->

        <script src="https://unpkg.com/localbase/dist/localbase.dev.js"></script>
        <script src="{% static 'utilityjs/lodash.min.js' %}"></script>
        <script src="{% static 'utilityjs/db.js' %}"></script>
        <script src="{% static 'assets/js/sweetalert2.all.min.js' %}"></script>
        <script src="{% static 'utilityjs/reconnectingws.min.js' %}"></script>
        <script src="{% static 'utilityjs/base.js' %}"></script>
        <script async="async" defer="defer" src="{% static 'utilityjs/groupchat.js' %}" 
        {% if user.is_authenticated %} data-authenticated="true" {% endif %}></script>
        <script src="{% static 'utilityjs/searchuser.js' %}"></script>
        <script async="async" defer="defer" src="{% static 'utilityjs/privatechat.js' %}" 
        {% if user.is_authenticated %} data-authenticated="true" {% endif %}>
        </script>

        <script type="text/javascript">
            function getIDs() {
          var lis = document.getElementById("contact_list_ul").getElementsByTagName("a");
            for (li of lis) {
                return [li.getAttribute('data-userid'),li.getAttribute('data-threadtype')];
                break;
          }
        }

        window.addEventListener("load", function(){
        //everything is fully loaded, don't use me if you can use DOMContentLoaded
        '{% if t_id%}'
            onSelectFriend('{{t_id}}');
        '{% elif gt_id %}'
            onSelectGroup('{{gt_id}}');
        '{% elif invalid_gt_id %}'
            alert('{{invalid_gt_id}}');
        '{% else %}'
        console.log("Khucching")
        '{% endif %}'
        });
        </script>
        <script>
            var removeActiveThreadFriend = ()=>{
                '{% if chat_threads %}'
                        '{% for thread in chat_threads %}'
                            '{% if thread.first_user or thread.second_user %}'
                                '{% if thread.first_user == request.user %}'
                                    document.getElementById("id_friend_list_{{thread.second_user.id}}").parentElement.classList.remove('active');
                                '{% else %}'
                                    document.getElementById("id_friend_list_{{thread.first_user.id}}").parentElement.classList.remove('active');
                                '{% endif %}'
                            '{% else %}'
                            if(document.getElementById("id_friend_list_{{thread.id}}")!=null){
                              document.getElementById("id_friend_list_{{thread.id}}").parentElement.classList.remove('active');
                            }
                            '{% endif %}'
                        '{% endfor %}'
                '{% endif %}'

            }
    </script>
    <script type="text/javascript">
        $(document).ready(async function(){
            let res = await fetch(window.location.origin+`/chat/chat_thread_list`,{
            method:'GET',
        
        })
        const r = await res.json()
        console.log("r is r",r);
        })
    </script>
        <script type="text/javascript">
            $(".user-profile-show").click(function () {
	        $(".user-profile-sidebar").show();
            });
            $("#user-profile-show-btn").trigger('click');
            '{% if keys %}'
                set_thread_list_messages();
            '{% endif %}'
        </script>

        <script type="text/javascript">
            var ulist = document.getElementById('contact_list_ul');
            $( document ).ready(function() {
                console.log( "ready!" );
               var myfunc = ()=>{
                  $.ajax({
                      type: "GET",
            
                      url: window.location.origin+'/chat/chat_thread_list/',
                      timeout: 5000,
                      success: (data) => {
                          console.log(data);
                          console.log(data['chat_threads']);
                          ulist.innerHTML = ''
                          data['chat_threads'].forEach(thread => {
                            if(thread.first_user || thread.second_user){
                              console.log("private chat")
                              if(thread.first_user.username === '{{request.user}}'){
                                var myhtml = `<li class="myclass">
                                                <a onclick="onSelectFriend('${thread.second_user.id}',this);"  data-userId="${thread.second_user.id}" id="id_friend_list_${thread.second_user.id}">
                                                    <div class="d-flex">                            
                                                        <div class="chat-user-img online align-self-center me-3 ms-0">
                                                            <img id="id_friend_img_${thread.second_user.id}" src="${thread.second_user.profile_image}" class="rounded-circle avatar-sm" alt="">
                                                            <!-- <span class="user-status"></span> -->
                                                        </div>
                                
                                                        <div class="flex-1 overflow-hidden">
                                                            <h5 class="text-truncate text-white font-size-15 mb-1">${thread.second_user.first_name} ${thread.second_user.last_name}</h5>
                                                            <p class="chat-user-message text-truncate mb-0">Hey! there I'm available</p>
                                                        </div>
                                                        <div class="font-size-11">05 min</div>
                                                    </div>
                                                </a>
                                            </li>`
                                 ulist.innerHTML += myhtml
                              }else{
                                var myhtml = `<li class="myclass active">
                                                <a onclick="onSelectFriend('${thread.first_user.id}',this);"  data-userId="${thread.first_user.id}" id="id_friend_list_${thread.first_user.id}">
                                                    <div class="d-flex">                            
                                                        <div class="chat-user-img online align-self-center me-3 ms-0">
                                                            <img id="id_friend_img_${thread.first_user.id}" src="${thread.first_user.profile_image}" class="rounded-circle avatar-sm" alt="">
                                                            <!-- <span class="user-status"></span> -->
                                                        </div>
                                
                                                        <div class="flex-1 overflow-hidden">
                                                            <h5 class="text-truncate text-white font-size-15 mb-1">${thread.first_user.first_name} ${thread.first_user.last_name}</h5>
                                                            <p class="chat-user-message text-truncate mb-0">Hey! there I'm available</p>
                                                        </div>
                                                        <div class="font-size-11">05 min</div>
                                                    </div>
                                                </a>
                                            </li>`
                                 ulist.innerHTML += myhtml
                                console.log(thread.first_user.username)
                              }
                            }else{
                              console.log("group chat")
                              var myhtml = `<li class="myclass">
                                                <a onclick="onSelectFriend('${thread.id}',this);"  data-userId="${thread.id}" id="id_friend_list_${thread.id}">
                                                    <div class="d-flex">                            
                                                        <div class="chat-user-img online align-self-center me-3 ms-0">
                                                            <img id="id_friend_img_${thread.id}" src="${thread.image}" class="rounded-circle avatar-sm" alt="">
                                                            <!-- <span class="user-status"></span> -->
                                                        </div>
                                
                                                        <div class="flex-1 overflow-hidden">
                                                            <h5 class="text-truncate text-white font-size-15 mb-1">${thread.group_name}</h5>
                                                            <p class="chat-user-message text-truncate mb-0">Hey! there I'm available</p>
                                                        </div>
                                                        <div class="font-size-11">05 min</div>
                                                    </div>
                                                </a>
                                            </li>`
                                 ulist.innerHTML += myhtml
                              console.log(thread.group_name)
                            }
                          })
                          
                      },
                      error: (data) => {
                          alert("Something went wrong: " + data)
                      },
                      complete: (data) => {
                          console.log("get completed.")
                      }
                  })
                 }
                //  myfunc();
                //  setTimeout(myfunc,1000);
                // setInterval(myfunc ,1500); 
            });
            
            
            
            </script>
        <!-- Magnific Popup-->
        <script src="{% static 'assets/libs/magnific-popup/jquery.magnific-popup.min.js' %}"></script>

        <!-- owl.carousel js -->
        <script src="{% static 'assets/libs/owl.carousel/owl.carousel.min.js' %}"></script>

        <!-- page init -->
        <script src="{% static 'assets/js/pages/index.init.js' %}"></script>

        <script src="{% static 'assets/js/app.js' %}"></script>
        <script src="{% static 'package/lightgallery.umd.js' %}"></script>
        <!-- Optional Plugins -->
        <script src="{% static 'package/plugins/autoplay/lg-autoplay.umd.js' %}"></script>
        <script src="{% static 'package/plugins/comment/lg-comment.umd.js' %}"></script>
        <script src="{% static 'package/plugins/fullscreen/lg-fullscreen.umd.js' %}"></script>
        <script src="{% static 'package/plugins/hash/lg-hash.umd.js' %}"></script>
        <script src="{% static 'package/plugins/mediumZoom/lg-medium-zoom.umd.js' %}"></script>
        <script src="{% static 'package/plugins/pager/lg-pager.umd.js' %}"></script>
        <script src="{% static 'package/plugins/relativeCaption/lg-relative-caption.umd.js' %}"></script>
        <script src="{% static 'package/plugins/rotate/lg-rotate.umd.js' %}"></script>
        <script src="{% static 'package/plugins/share/lg-share.umd.js' %}"></script>
        <script src="{% static 'package/plugins/thumbnail/lg-thumbnail.umd.js' %}"></script>
        <script src="{% static 'package/plugins/video/lg-video.umd.js' %}"></script>
        <script src="{% static 'package/plugins/zoom/lg-zoom.umd.js' %}"></script>
        <script type="text/javascript">
            lightGallery(document.querySelector('.myGallery'),{
                // plugins: [lgAutoplay, lgComment, lgFullscreen, lgHash, lgPager, lgRotate, lgShare, lgVideo, lgZoom, lgThumbnail],
                plugins: [lgAutoplay,lgComment, lgFullscreen, lgHash, lgPager, lgRotate, lgShare, lgVideo, lgZoom,],
                mode: 'lg-slide' | 'lg-fade' | 'lg-zoom-in' | 'lg-zoom-in-big' | 'lg-zoom-out' | 'lg-zoom-out-big' | 'lg-zoom-out-in' | 'lg-zoom-in-out' | 'lg-soft-zoom' | 'lg-scale-up' | 'lg-slide-circular' | 'lg-slide-circular-vertical' | 'lg-slide-vertical' | 'lg-slide-vertical-growth' | 'lg-slide-skew-only' | 'lg-slide-skew-only-rev' | 'lg-slide-skew-only-y' | 'lg-slide-skew-only-y-rev' | 'lg-slide-skew' | 'lg-slide-skew-rev' | 'lg-slide-skew-cross' | 'lg-slide-skew-cross-rev' | 'lg-slide-skew-ver' | 'lg-slide-skew-ver-rev' | 'lg-slide-skew-ver-cross' | 'lg-slide-skew-ver-cross-rev' | 'lg-lollipop' | 'lg-lollipop-rev' | 'lg-rotate' | 'lg-rotate-rev' | 'lg-tube',
            });
        </script>
    </body>

</html>
